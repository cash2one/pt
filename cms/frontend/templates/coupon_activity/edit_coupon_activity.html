{% extends "base.html" %}
{% load static %}
{% block title %}编辑业务活动{% endblock %}
{% block head %}
<style>
        *{
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
        .dashhr{
            margin: 10px 0;
            border-top: 1px dashed #ccc;;
        }
        .sendmsg-form label{
            width:16%;
            text-align: right;
            margin-right: 1%;
        }
        .sendmsg-form .col-lg-12 label{
            width:8%;
            margin-right: .5%;
            vertical-align: middle;
        }
        .sendmsg-form .form-control,.sendmsg-form select{
            display: inline-block;
            width:80%;
        }
        .sendmsg-form .col-lg-12 .form-control{
            width:90%;
            vertical-align: middle;
        }
        .sendmsg-form a.addpicbtn{
            cursor:pointer;
            font-size: 40px;
            padding: 10px 22px;
            border: 2px solid #999;
            color: #999;
            cursor: pointer;
        }
        .citylist{
            width: 90%;
            display: inline-block;
            vertical-align: top;
        }
        .correctbtn{
            color: #337ab7;
            margin-left: 470px;
            margin-bottom: 20px;
            display: none;
        }
        .correctbtn:hover{
            color:blue;
            cursor: pointer;
        }
        #validataDiv{
            padding-left:10%;
        }
        #validataDiv .form-group label{
            width:4%;
            text-align: left;
        }
         .selected{
        color: red;
        font-size: 17px;
    }
    select[multiple], select[size] {
        height: 200px;
    }
</style>
<link rel="stylesheet" href="{% static 'css/selectImg.css' %}"/>
<link rel="stylesheet" href="{% static 'css/webuploader.css' %}"/>
{% endblock %}
{% block content %}
<div class="cms-subtitle">
    <ol class="breadcrumb" >
        <li><a href="{% url 'main_index' %}?t={{ t }}">{{ text }}</a></li>
        <li><a href="{% url 'main_index' %}?t={{ t }}">{{ v }}</a></li>
        <li><a href="{% url 'config_item' %}?t={{ t }}&v={{ v }}&c={{ c }}">{{ c }}</a></li>
        <li><a href="{% url 'coupon_activities' %}?t={{ t }}&v={{ v }}&c={{ c }}">活动</a></li>
        <li class="active">编辑活动</li>
    </ol>
</div>
<div id="error-hints">
</div>
<form class="sendmsg-form" action="{% url 'coupon_edit_activity' %}?channel={{ channel }}&id={{ id }}" method="post" enctype="multipart/form-data">{% csrf_token %}

    <div style="display: none;">
        <label>城市</label>
        <input name="city" value="" type="hidden" id="citystr"/>
    </div>
    <input name="type" value="0" type="hidden" id="type"/>
    <input name="valid_time" value="" type="hidden" id="valid_time"/>
    <!--   <p class="dashhr"></p> -->
    <div class="row">
        <div class="col-lg-6">
            <div class="form-group">
                <label><i>*</i>图片:</label>
                <a class="addpicbtn">+</a>
                <input name="img" value="" id="img" type="hidden"/>
            </div>
        </div>
    </div>
    <p class="dashhr"></p>
    <div class="row">
        <div class="col-lg-6">
                <div class="form-group">
                    <label><i>*</i>入口名称:</label>
                    <input type="text" class="form-control" name="name" id="name" required/>
                </div>
            </div>
                       <div class="col-lg-6">
                <div class="form-group">
                    <label><i>*</i>动作:</label>
                    <div style="position: relative;display: inline-block;width: 80%;">

                            <div class="input-group-lg form-control" style="width:100%;height: 300px;padding: 6px 0;overflow-y: auto;position: absolute;z-index: 999;top: 33px;display: none" id="actionselect" name="action_id">
                                <a data-value=""></a>
                                {% for action in actions %}
                                <a data-value="{{ action.0 }}" onclick="selectAction(this)">{{ action.1 }}</a>
                                {% endfor %}
                                {#                        <option class="form-control">测试0</option>#}
                                {#                        <option class="form-control">测试1</option>#}
                                {#                        <option class="form-control">测试2</option>#}
                            </div>

                        <input type="hidden" id="action_id" name="action_id" class="form-control" style="width:400px;"/>
                        <input type="text" id="action_uid" name="action_uid" class="form-control" style="width:100%;" required maxlength="11" placeholder="请选择下拉列表中的动作或输入搜索"/>

                    </div>
                </div>
                <a class="correctbtn">修改Action Json</a>
            </div>
        </div>
        <div class="row correctcontent" style="display: none">
            <div class="col-lg-12">
                <div class="form-group">
                    <label>Action Json：</label>
                    <textarea class="form-control" name="action_json" id="action_json"></textarea>
                </div>

            </div>
        </div>
    <div class="row">
    <div class="col-lg-6">
            <div class="form-group">
                <label><i>*</i>展示优先级:</label>
                <input type="text" class="form-control" name="priority" id="priority" required/>
            </div>
        </div>
    </div>
    <p class="dashhr"></p> 
    <div class="row">
        <div class="col-lg-6">
            <div class="form-group">
                <label><i>*</i>品牌:</label>
                    <input type="hidden" class="form-control" name="cp_lst" id="cp_lst"/>
                    <input type="text" class="form-control"  id="multi-select_1" required/>
                    <!-- <input type="search" name="" value="请选择品牌" placeholder="" class="form-control pt-form-control " id="multi-select1"  readonly="readonly" /> -->
                    <select   multiple  style="display:none ;margin-left:17.3%;" class="input-group-lg form-control cp_list" maxlength="11">
                        <option  value="*" class="cp_item_1" onclick="select_cp()">全部</option>
                        {% for cp in cps %}
                        <option  value="{{ cp.0 }}" onclick="select_cp()">{{ cp.1 }}</option>
                        {% endfor %}
                    </select>
            </div>
        </div>

         <div class="col-lg-6">
            <div class="form-group">
                <label><i>*</i>商品:</label>
                    <input type="hidden" class="form-control" name="goods_lst" id="goods_lst"/>
                    <input type="text" class="form-control"  id="multi-select_2" required/>
                    <!-- <input type="search" name="" value="请选择品牌" placeholder="" class="form-control pt-form-control " id="multi-select1"  readonly="readonly" /> -->
                    <select   multiple  style="display:none ;margin-left:17.3%;" class="input-group-lg form-control goods_list" maxlength="11">
                        <option  value="*" class="cp_item_2" onclick="select_good()">全部</option>
                        {% for good in goods %}
                        <option  value="{{ good.0 }}" onclick="select_good()">{{ good.1 }}</option>
                        {% endfor %}
                    </select>
            </div>
        </div>

    </div>
    <p class="dashhr"></p>
     <div class="row">
            <div class="col-lg-12">
                <div class="form-group">
                    <label><i>*</i>有效时间：</label>
                    <select class="form-control" id="validateTime">
                        <option selected  value="0">不限</option>
                        <option value="1">选择有效时间</option>
                    </select>
                </div>
                <div id="validataDiv" class="" style="display: none">
                    <div class="form-group field-cmsvalidtimemodel-month">
                        <label class="control-label" for="cmsvalidtimemodel-month">月</label>
                        <input type="hidden" name="CmsValidTimeModel[month]" value="*">
                        <div id="cmsvalidtimemodel-month">
                            <label><input type="checkbox" name="CmsValidTimeModel[month][]" value="1"> 一月</label>
                            <label><input type="checkbox" name="CmsValidTimeModel[month][]" value="2"> 二月</label>
                            <label><input type="checkbox" name="CmsValidTimeModel[month][]" value="3"> 三月</label>
                            <label><input type="checkbox" name="CmsValidTimeModel[month][]" value="4"> 四月</label>
                            <label><input type="checkbox" name="CmsValidTimeModel[month][]" value="5"> 五月</label>
                            <label><input type="checkbox" name="CmsValidTimeModel[month][]" value="6"> 六月</label>
                            <label><input type="checkbox" name="CmsValidTimeModel[month][]" value="7"> 七月</label>
                            <label><input type="checkbox" name="CmsValidTimeModel[month][]" value="8"> 八月</label>
                            <label><input type="checkbox" name="CmsValidTimeModel[month][]" value="9"> 九月</label>
                            <label><input type="checkbox" name="CmsValidTimeModel[month][]" value="10"> 十月</label>
                            <label><input type="checkbox" name="CmsValidTimeModel[month][]" value="11"> 十一月</label>
                            <label><input type="checkbox" name="CmsValidTimeModel[month][]" value="12"> 十二月</label>
                        </div>
                    </div>


                <div class="form-group field-cmsvalidtimemodel-day">
                    <label class="control-label" for="cmsvalidtimemodel-day">日</label>
                    <input type="hidden" name="CmsValidTimeModel[day]" value="*">
                    <div id="cmsvalidtimemodel-day">
                        <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="1"> 1</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="2"> 2</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="3"> 3</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="4"> 4</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="5"> 5</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="6"> 6</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="7"> 7</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="8"> 8</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="9"> 9</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="10"> 10</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="11"> 11</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="12"> 12</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="13"> 13</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="14"> 14</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="15"> 15</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="16"> 16</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="17"> 17</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="18"> 18</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="19"> 19</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="20"> 20</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="21"> 21</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="22"> 22</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="23"> 23</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="24"> 24</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="25"> 25</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="26"> 26</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="27"> 27</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="28"> 28</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="29"> 29</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="30"> 30</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[day][]" value="31"> 31</label></div>
                </div>


                <div class="form-group field-cmsvalidtimemodel-week">
                    <label class="control-label" for="cmsvalidtimemodel-week">周</label>
                    <input type="hidden" name="CmsValidTimeModel[week]" value="*"><div id="cmsvalidtimemodel-week"><label><input type="checkbox" name="CmsValidTimeModel[week][]" value="1"> 周一</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[week][]" value="2"> 周二</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[week][]" value="3"> 周三</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[week][]" value="4"> 周四</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[week][]" value="5"> 周五</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[week][]" value="6"> 周六</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[week][]" value="7"> 周日</label></div>

                </div>

                 <div class="form-group field-cmsvalidtimemodel-hour">
                    <label class="control-label" for="cmsvalidtimemodel-hour">小时</label>
                    <input type="hidden" name="CmsValidTimeModel[hour]" value="*"><div id="cmsvalidtimemodel-hour"><label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="0"> 0</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="1"> 1</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="2"> 2</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="3"> 3</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="4"> 4</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="5"> 5</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="6"> 6</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="7"> 7</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="8"> 8</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="9"> 9</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="10"> 10</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="11"> 11</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="12"> 12</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="13"> 13</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="14"> 14</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="15"> 15</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="16"> 16</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="17"> 17</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="18"> 18</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="19"> 19</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="20"> 20</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="21"> 21</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="22"> 22</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[hour][]" value="23"> 23</label></div>
                </div>
                <div class="form-group field-cmsvalidtimemodel-minute">
                    <label class="control-label" for="cmsvalidtimemodel-minute">分</label>
                    <input type="hidden" name="CmsValidTimeModel[minute]" value="*">
                    <div id="cmsvalidtimemodel-minute">
                        <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="0"> 0</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="1"> 1</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="2"> 2</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="3"> 3</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="4"> 4</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="5"> 5</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="6"> 6</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="7"> 7</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="8"> 8</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="9"> 9</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="10"> 10</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="11"> 11</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="12"> 12</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="13"> 13</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="14"> 14</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="15"> 15</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="16"> 16</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="17"> 17</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="18"> 18</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="19"> 19</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="20"> 20</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="21"> 21</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="22"> 22</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="23"> 23</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="24"> 24</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="25"> 25</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="26"> 26</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="27"> 27</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="28"> 28</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="29"> 29</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="30"> 30</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="31"> 31</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="32"> 32</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="33"> 33</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="34"> 34</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="35"> 35</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="36"> 36</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="37"> 37</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="38"> 38</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="39"> 39</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="40"> 40</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="41"> 41</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="42"> 42</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="43"> 43</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="44"> 44</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="45"> 45</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="46"> 46</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="47"> 47</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="48"> 48</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="49"> 49</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="50"> 50</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="51"> 51</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="52"> 52</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="53"> 53</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="54"> 54</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="55"> 55</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="56"> 56</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="57"> 57</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="58"> 58</label>
                    <label><input type="checkbox" name="CmsValidTimeModel[minute][]" value="59"> 59</label>
                </div>
                </div>
            </div>
                    </div>
            </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="form-group">
                    <label><i>*</i>城市：</label>
                   <select class="input-group-lg form-control" name="cityselect_id" value="" id="cityselect_id">
                       <option class="form-control" value="0">不限（全国）</option>
                       <option class="form-control" value="1">选择其他城市</option>
                    </select>
                </div>
            </div>
        </div>


        <div id="city-selection" style="display: none">


            <div class="row">
                <div class="col-lg-12">
                    <div class="form-group city-wrap">
                            <label></label>

                            <div class="city-spec"></div>
                            <div class="citylist">
                                <div class="list-group">
                    <!--                <div class="width1in8">
                                        <div class="col-lg-10 list-group-item list-inline">
                                            <input type="checkbox"/>
                                            全国
                                        </div>
                                    </div>
                                    <div class="width1in8">
                                        <div class="col-lg-10 list-group-item list-inline">
                                            <input type="checkbox"/>
                                            广东省
                                        </div>
                                    </div>-->

                                </div>
                           </div>
                    </div>
                </div>
            </div>
        </div><!--the end of the cityselection-->
        <div class="row text-center">
            <a href="{% url 'coupon_activities' %}?t={{ t }}&v={{ v }}&c={{ c }}" class="btn btn-default col-lg-1 col-lg-offset-4">取消</a>
            <input type="submit" class="btn btn-success col-lg-1 col-lg-offset-1" value="确定"/>
            <input type="hidden" name="citylst" id="citystr">
        </div>




        <div id="dialogUpload" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" style="display: none;">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">

                    <div class="modal-header">
                        <div class="header">
                            <input id="searchImg" class="input-sm" type="text" placeholder="请输入关键词搜索"/>
                            <button class="btn btn-info" id="searchBtn">搜索</button>
                            <p class="toolbar pull-right">
                                <button id="usepic" class="btn btn-warning">确认使用</button>
                                <button type="button" class="btn btn-primary" id="addLocalImg">本地上传</button>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                            </p>
                        </div>
                    </div>
                    <div class="modal-body">
                        <ul class="nav nav-tabs pull-right" role="tablist" id="pic-nav">
                            <li  class="active"><a href="#">广告图片</a></li>
                            <li><a href="#">大图标</a></li>
                            <li><a href="#">小图标</a></li>
                            <li><a href="#">优惠券</a></li>
                            <li><a href="#">其他</a></li>
                        </ul>
                        <div class="tab-content" style="clear:both">
                            <div  class="tab-pane active" id="adspic">
                                <div id="loading" style="display:none;    position: inherit;    margin: 1.5rem 420px;">
                                    <img src="{% static 'images/loading.gif' %}"/>
                                </div>
                                <div class="imglist">

                                </div>
                                <div id="pagination"></div>
                            </div>
                        </div>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div>


        <div id="UploadModal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" style="display: none;">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        上传图片到图库<!--<h4 class="modal-title" id="myLargeModalLabel"></h4>-->
                        <p class="pull-right">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                            <button class="btn btn-info pull-right" id="useTheImg" style="display: none;">使用该图片</button>
                        </p>

                        <!--<input type="button" class="btn btn-primary" value="浏览本地文件"/>-->
                    </div>
                    <div class="modal-body">
                        <div id="uploader-demo">
                            <!--用来存放item-->
                            <div id="fileList" class="uploader-list"></div>
                            <div id="filePicker" style="text-align: right"> 选择图片</div>
                        </div>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div>
    </form>

    <script type="text/javascript" src="{% static 'js/cms/addCityList.js' %}"></script>
    <script type="text/javascript">
    setNavBg({{t}});
        var g_cities= {{ cities|safe }} || {};
       
        
        
        $("#group_id").change(function(){
        chooseCityGroup(this,'{% url 'get_city_from_group_id' %}');
    });
        

                    var cp_id_list = [];

                function select_cp() {
                    var cp_id = $(event.target).val();
                    mypush(cp_id_list,cp_id);
                    if (!$(event.target).hasClass('selected')) {
                        if($(event.target).val()=="*") {
                            $(event.target).siblings().removeClass('selected');
                            cp_id_list=["*"];
                        }
                        else{
                            $(cp_id_list).each(function(i,item){
                                if(item=="*") {
                                    arrRemove(cp_id_list, i);
                                }
                            });
                            $('select.cp_list option[value="*"]').removeClass('selected');
                        }
                        $(event.target).addClass('selected');

                    } else {
                        $(event.target).removeClass('selected');
                    }
                    //更新内容
                    var cp_name_list = [];

                    $(cp_id_list).each(function(i,item){
                                 cp_name_list.push($('select.cp_list option[value="'+item+'"]').text());
                            });
                    $("#multi-select_1").prop('value', cp_name_list);
                    $("#cp_lst").prop('value',cp_id_list);
                    console.log("cp_id_list: "+cp_name_list);

                }
                    var goods_id_list = [];

                    function select_good() {
                    var cp_id = $(event.target).val();
                    mypush(goods_id_list,cp_id);
                    if (!$(event.target).hasClass('selected')) {
                        if($(event.target).val()=="*") {
                            $(event.target).siblings().removeClass('selected');
                            goods_id_list=["*"];
                        }
                        else{
                            $(goods_id_list).each(function(i,item){
                                if(item=="*") {
                                    arrRemove(goods_id_list, i);
                                }
                            });
                            $('select.goods_list option[value="*"]').removeClass('selected');
                        }
                        $(event.target).addClass('selected');

                    } else {
                        $(event.target).removeClass('selected');
                    }
                    //更新内容
                    var cp_name_list = [];

                    $(goods_id_list).each(function(i,item){
                                 cp_name_list.push($('select.goods_list option[value="'+item+'"]').text());
                            });
                    $("#multi-select_2").prop('value', cp_name_list);
                    $("#goods_lst").prop('value',goods_id_list);

                    console.log("goods_id_list: "+cp_name_list);

                }
                 $(".cp_item_1").click(function(event) {
                     // $('.goods_list').toggle();
                     $('.cp_list').css('display', 'none');
                    });
                 $(".cp_item_2").click(function(event) {
                     // $('.goods_list').toggle();
                     $('.goods_list').css('display', 'none');
                    });
                function stopPropagation(e) { //取消事件冒泡
                    if (e.stopPropagation)
                        e.stopPropagation();
                    else
                        e.cancelBubble = true;
                }
                $(document).on('click', function() { //点击除#multi-select,#target_channel_id之外的区域隐藏多选下拉列表
                    $('.cp_list').css('display', 'none');
                });
                $(document).on('click', function() { //点击除#multi-select,#target_channel_id之外的区域隐藏多选下拉列表
                    $('.goods_list').css('display', 'none');
                });
                $('#multi-select_1,.cp_item_1,.cp_list').bind('click', function(e) { //为#multi-select,#target_channel_id取消事件冒泡
                    stopPropagation(e);
                });
                $("#multi-select_1").click(function(event) {
                    $(".cp_list").toggle();
                });
                $('#multi-select_2,.coupons_item_2,.goods_list').bind('click', function(e) { //为#multi-select,#target_channel_id取消事件冒泡
                    stopPropagation(e);
                });
                $("#multi-select_2").click(function(event) {
                    $(".goods_list").toggle();
                });


        $("form").submit(function(){
            var citystr="";
            var city_idex=$("#cityselect_id").find("option:selected").val();
            //判断选择的是不限（全国），还是其它城市
            if(city_idex==0){
                citystr+='*';
            }else if(city_idex==1){
                var ckd=$(".citydetailist input[type='checkbox']");
                var ckd_city=$(".list-group-item input[type='checkbox']");
                var ckd_city_len=ckd_city.length;
                var ckd_len=ckd.length;
                for(var j=0;j< ckd_city_len; j++){
                    if(ckd_city[j].checked && ($(ckd_city[j]).val()=="全国")) {
                        citystr+='*,';
                    }
                    if(ckd_city[j].checked && ( $(ckd_city[j]).val()=="上海" || $(ckd_city[j]).val()=="重庆" || $(ckd_city[j]).val()=="天津" || $(ckd_city[j]).val()=="北京")) {
                        citystr+=$(ckd_city[j]).val()+',';
                    }
                }
                for(var i=0;i<ckd_len;i++){
                    if(ckd[i].checked){
                        citystr+=$(ckd[i]).val()+',';
                    }
                }
                citystr=citystr.substring(0,citystr.length-1);
            }

            $("#citystr").val(citystr);
            console.log("所选城市为"+citystr);
            sendTime();

            var actions={{ actions|safe }};
            console.log(actions);
            var action_val=$("#action_uid").val();
            var count_times=0;
            $.each(actions,function(key,item){
                if((item[0])==action_val){
                    count_times++;
                }
            })
            if(count_times<=0){
                var errorstr='<ul><li>动作 ： 请选择下拉框内的可选动作。</li></ul>';
                $("#error-hints").html(errorstr).show();
                $("#action_uid").css("border","1px solid #D9534F");
                return false;
            }else {
                return true;
            }


        });

        checkForm({{ errors|safe }});


        $("form input").focus(function(){
           $(this).css("border","1px solid #ccc");
        });




        function setInPutValue(){
{#        console.log("{{ goods_form.initial }}");#}
        {% for key,value in fields.items %}
            $("[name='{{ key }}']").val({{ value|safe }});
        {% endfor %}
{#        console.log("{{ goods_form.city.value }}")#}

        //console.log($('#cp_lst').val());
        //console.log($('select.cp_list').find('option').length);
        //$('select.cp_list').find('option').each(function(key,val){});
        var arr_cp=[];
        var arr_goods=[];
        $($('#cp_lst').val().split(",")).each(function(i,item){
            //console.log(item);
            $('select.cp_list option[value='+item+']').addClass('selected');
            arr_cp.push($('select.cp_list option[value='+item+']').text());
        });
        $($('#goods_lst').val().split(",")).each(function(i,item){
            //console.log(item);
            $('select.goods_list option[value='+item+']').addClass('selected');
            arr_goods.push($('select.goods_list option[value='+item+']').text());
        });
        $("#multi-select_2").prop('value', arr_goods.join(","));
        $("#multi-select_1").prop('value',arr_cp.join(","));

        checkDate();
        var action_str=$("#action_id").val();
        $("#action_uid").val(action_str);
         if($("#action_id").val()==-1){
            $(".correctcontent").show();
        }

        $(".addpicbtn").next("input[type=hidden]").each(function(){
            if(this.value != ''){
                var addbtn = $(this).prev(".addpicbtn");
                $('<div  class="newImg"><img src="'+getImgURL(this.value)+'"/><span class="glyphicon glyphicon-remove"></span>           </div>').insertAfter(addbtn);
                addbtn.hide();
            }
        });
        cityDrop();
            returnCityValue();
    }



      $(window).ready(function(){
          setInPutValue();
          $("#multi-select_1").show();

          if($("#cp_lst").val()){

                        cp_id_list = $("#cp_lst").val().split(",");
{#                        console.log(cp_id_list);#}
                    }
                    if($("#goods_lst").val()){

                        goods_id_list = $("#goods_lst").val().split(",");
                        console.log(goods_id_list);
                    }
      });
    </script>
<script type="text/javascript" src="{% static 'js/cms/selectImg.js' %}"></script>
    <script>
    (function(){
        $(".correctcontent").hide();
         $("#action_uid").focus(function(){
             $("#actionselect").show();
         });

        $("#action_uid").on("input propertychange",function(){
            var action_str=$(this).val();
            var action_arr=$("#actionselect a");
            var act_len=action_arr.length;
            for(var i=0;i<act_len;i++){
                var htmlstr=$(action_arr[i]).html();
                if(htmlstr.indexOf(action_str)>=0){
                    $(action_arr[i]).show();
                }else {
                    $(action_arr[i]).hide();
                }
            }

        });

        $(".correctbtn").click(function(){
            $(".correctcontent").show();
            $(this).hide();
        });

     })();

    selectCity();

    function requestData(cur_page){
        $(".pagelist li").eq(cur_page).css('background', '#34cb95');
        g_cur_page = cur_page;
        $.ajax("{% url 'get_images' %}",{
            type:"get",
            cache:false,
            data:{
                key: searchkeywords,
                cur_page: cur_page,
                per_page: g_per_page,
                image_category:cur_category
            },
            dataType:'json',
            beforeSend:function(XMLHttpRequest){
                $("#loading").show();

            },
            success:function(result){
                //   console.log(result);
                var data = result[0];
                var num_pages = result[1];
                CreateImgList(data);
                pagination(num_pages);
            },
            error:function(result){
                console.log(result);
            },
            complete:function(result){
                $("#loading").hide();
                 $(".pagelist li").eq(cur_page).css('background', '#34cb95');
                  if(cur_page>5){
                  $(".pagelist li").eq(cur_page-5).prevAll().hide();
                }
            }

        })
    }


    </script>
<script type="text/javascript" src="{% static 'js/cms/webuploader.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/cms/uploadimg.js' %}"></script>

                        {% endblock %}